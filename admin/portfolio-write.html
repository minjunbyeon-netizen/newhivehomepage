<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Writing - HiveMedia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: white;
            border-bottom: 1px solid #eee;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .back-btn {
            background: transparent;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            text-decoration: none;
            color: #1a1a1a;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .preview-panel {
                display: none;
            }
        }

        .form-column {
            max-width: 600px;
        }

        .preview-panel {
            background: #0a0a0a;
            border-radius: 8px;
            overflow: hidden;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .preview-header {
            background: #1a1a1a;
            padding: 12px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 8px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .preview-header span {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .preview-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .preview-content {
            padding: 40px 30px;
            color: white;
        }

        .preview-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.3;
            color: white;
        }

        .preview-meta {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .preview-meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .preview-meta-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .preview-meta-value {
            font-size: 14px;
            color: #fff;
        }

        .preview-desc {
            font-size: 14px;
            line-height: 1.8;
            color: #aaa;
            margin-bottom: 30px;
            white-space: pre-line;
        }

        .preview-direction {
            background: #111;
            padding: 24px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .preview-direction-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 16px;
        }

        .preview-direction-main {
            font-size: 14px;
            line-height: 1.7;
            color: #ccc;
            margin-bottom: 20px;
        }

        .preview-direction-main strong {
            color: #c4a77d;
        }

        .preview-direction-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .preview-direction-item {
            display: grid;
            grid-template-columns: 24px 1fr;
            gap: 12px;
            font-size: 13px;
            color: #ccc;
        }

        .preview-direction-item .num {
            color: #666;
            font-size: 11px;
        }

        .preview-direction-item strong {
            color: #c4a77d;
        }

        .preview-empty {
            text-align: center;
            padding: 60px 20px;
            color: #555;
        }

        .preview-empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .preview-empty-text {
            font-size: 14px;
        }

        .preview-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 24px;
            max-height: 200px;
            object-fit: cover;
        }

        .preview-metrics {
            background: #111;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .preview-metrics-title {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
        }

        .preview-metric-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #222;
            font-size: 13px;
        }

        .preview-metric-item:last-child {
            border-bottom: none;
        }

        .preview-metric-type {
            color: #888;
        }

        .preview-metric-value {
            color: #c4a77d;
            font-weight: 600;
        }

        .form-card {
            background: white;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .form-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .form-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 32px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #1a1a1a;
            font-size: 14px;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .file-input-wrapper {
            position: relative;
        }

        .file-input-label {
            display: block;
            padding: 12px;
            background: #f5f5f5;
            border: 1px dashed #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .file-input-label:hover {
            background: #eee;
        }

        input[type="file"] {
            display: none;
        }

        .submit-btn {
            width: 100%;
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 16px;
        }

        .submit-btn:hover {
            background: #333;
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .success-msg {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 20px;
            display: none;
        }

        .success-msg.show {
            display: block;
        }

        .descriptions-section {
            border-top: 1px solid #eee;
            padding-top: 24px;
            margin-top: 24px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        /* Logo Redirect Style */
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .home-logo {
            cursor: pointer;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
        }

        .home-logo:hover {
            opacity: 0.8;
        }

        .home-logo img {
            height: 24px;
            width: auto;
        }

        /* Metrics Section */
        .metric-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }

        .metric-type,
        .metric-value {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .metric-type:focus,
        .metric-value:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .remove-metric-btn {
            width: 36px;
            height: 36px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 20px;
            line-height: 1;
            transition: all 0.2s;
        }

        .remove-metric-btn:hover {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
        }

        .add-metric-btn {
            display: inline-block;
            padding: 10px 16px;
            background: #f5f5f5;
            border: 1px dashed #ddd;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .add-metric-btn:hover {
            background: #eee;
            border-color: #1a1a1a;
        }

        /* Image Upload Styles */
        .upload-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 8px;
        }

        .upload-text {
            display: block;
            font-size: 14px;
        }

        .file-input-label.has-file {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .image-preview {
            margin-top: 16px;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            margin-bottom: 12px;
            display: block;
        }

        .image-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .image-filename {
            font-size: 14px;
            font-weight: 500;
            color: #1a1a1a;
            flex: 1;
        }

        .image-size {
            font-size: 12px;
            color: #666;
            padding: 4px 8px;
            background: #fff;
            border-radius: 4px;
        }

        .remove-image-btn {
            padding: 6px 12px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .remove-image-btn:hover {
            background: #cc0000;
        }

        /* Additional Images Preview */
        .additional-images-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .additional-image-item {
            position: relative;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 8px;
        }

        .additional-image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .additional-image-info {
            font-size: 11px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: 8px;
        }

        .additional-image-remove {
            width: 100%;
            padding: 4px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .additional-image-remove:hover {
            background: #cc0000;
        }

        .image-count-badge {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 8px;
            background: #1a1a1a;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .metric-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .metric-type,
            .metric-value {
                width: 100%;
            }

            .remove-metric-btn {
                width: 100%;
                height: 40px;
            }

            .additional-images-preview {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .item-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="header-left">
            <div class="home-logo">
                <img src="../assets/img/logo_img_b.png" alt="HiveMedia">
            </div>
            <h1>Portfolio Writing</h1>
        </div>
        <a href="dashboard.html" class="back-btn">Back to Dashboard</a>
    </div>

    <div class="container">
        <div class="form-column">
            <div class="form-card">
                <h2 class="form-title">New Portfolio Item</h2>
                <p class="form-subtitle">Create a new portfolio entry</p>

                <div class="success-msg" id="successMsg"></div>

                <form id="portfolioForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="title">Title *</label>
                            <input type="text" id="title" required>
                        </div>

                        <div class="form-group">
                            <label for="category">Category *</label>
                            <select id="category" required>
                                <option value="">Select category</option>
                                <option value="Online AD">Online AD</option>
                                <option value="SNS">SNS</option>
                                <option value="Homepage">Homepage</option>
                                <option value="Eventpage">Eventpage</option>
                                <option value="Video">Video</option>
                                <option value="Print">Print</option>
                                <option value="Exhibition Art">Exhibition Art</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="client">Client Name *</label>
                            <input type="text" id="client" required>
                        </div>

                        <div class="form-group">
                            <label for="projectType">Project Type *</label>
                            <input type="text" id="projectType" required
                                placeholder="Ïòà: Brand Identity, Campaign, Web Design">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="year">Year *</label>
                            <input type="text" id="year" required placeholder="Ïòà: 2024">
                        </div>

                        <div class="form-group">
                            <label for="periodStart">Period Start</label>
                            <input type="date" id="periodStart">
                        </div>

                        <div class="form-group">
                            <label for="periodEnd">Period End</label>
                            <input type="date" id="periodEnd">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="subtitle">Subtitle</label>
                        <input type="text" id="subtitle">
                    </div>

                    <div class="descriptions-section">
                        <div class="section-title">Project Descriptions</div>

                        <div class="form-group">
                            <label for="description1">ÌîÑÎ°úÏ†ùÌä∏ Í∞úÏöî *</label>
                            <textarea id="description1" required
                                placeholder="Ïòà: Î≥∏ Ï∫†ÌéòÏù∏ÏùÄ Ïã†Ï†úÌíà Îü∞Ïπ≠ÏùÑ ÏúÑÌïú ÌÜµÌï© ÎßàÏºÄÌåÖ ÌîÑÎ°úÏ†ùÌä∏Î°ú, SNS Í¥ëÍ≥†ÏôÄ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÎßàÏºÄÌåÖÏùÑ Í≤∞Ìï©ÌïòÏó¨ Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑÎ•º ÎÜíÏù¥Í≥† Íµ¨Îß§ Ï†ÑÌôòÏú®ÏùÑ Ï¶ùÎåÄÏãúÌÇ§Îäî Í≤ÉÏùÑ Î™©ÌëúÎ°ú Ìï©ÎãàÎã§."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="description2">Ï£ºÏöî ÏÑ±Í≥º ÏßÄÌëú</label>
                            <div id="metricsContainer">
                                <div class="metric-row">
                                    <select class="metric-type">
                                        <option value="">ÏßÄÌëú ÏÑ†ÌÉù</option>
                                        <option value="ROAS">ROAS (Í¥ëÍ≥† Ìà¨Ïûê ÏàòÏùµÎ•†)</option>
                                        <option value="Ï°∞ÌöåÏàò">Ï°∞ÌöåÏàò</option>
                                        <option value="Ïù¥Î≤§Ìä∏ Ï∞∏Ïó¨Ïûê">Ïù¥Î≤§Ìä∏ Ï∞∏Ïó¨Ïûê Ïàò</option>
                                        <option value="Ï†ÑÌôòÏú®">Ï†ÑÌôòÏú® (%)</option>
                                        <option value="ÌÅ¥Î¶≠Î•†">ÌÅ¥Î¶≠Î•† (CTR %)</option>
                                        <option value="ÎèÑÎã¨">ÎèÑÎã¨ Ïàò</option>
                                        <option value="Ï∞∏Ïó¨Ïú®">Ï∞∏Ïó¨Ïú® (%)</option>
                                        <option value="Íµ¨Îß§ Ï†ÑÌôò">Íµ¨Îß§ Ï†ÑÌôò Ïàò</option>
                                        <option value="Îß§Ï∂ú">Îß§Ï∂ú Ï¶ùÍ∞ÄÏú® (%)</option>
                                        <option value="Ìä∏ÎûòÌîΩ">ÏõπÏÇ¨Ïù¥Ìä∏ Ìä∏ÎûòÌîΩ Ï¶ùÍ∞Ä (%)</option>
                                        <option value="Î∏åÎûúÎìú Ïñ∏Í∏â">Î∏åÎûúÎìú Ïñ∏Í∏âÎüâ Ï¶ùÍ∞Ä (%)</option>
                                        <option value="ÌåîÎ°úÏõå">ÌåîÎ°úÏõå Ï¶ùÍ∞Ä Ïàò</option>
                                    </select>
                                    <input type="text" class="metric-value" placeholder="ÏàòÏπò ÏûÖÎ†• (Ïòà: 450, 3.2)">
                                    <button type="button" class="remove-metric-btn"
                                        onclick="removeMetric(this)">√ó</button>
                                </div>
                            </div>
                            <button type="button" class="add-metric-btn" onclick="addMetric()">+ ÏÑ±Í≥º ÏßÄÌëú Ï∂îÍ∞Ä</button>
                        </div>
                    </div>

                    <div class="descriptions-section">
                        <div class="section-title">Images</div>

                        <div class="form-group">
                            <label for="thumbnail">Thumbnail Image *</label>
                            <div class="file-input-wrapper">
                                <label for="thumbnail" class="file-input-label" id="thumbnailLabel">
                                    <span class="upload-icon">üìé</span>
                                    <span class="upload-text">Choose file or drag here</span>
                                </label>
                                <input type="file" id="thumbnail" accept="image/*" required>
                            </div>
                            <div id="thumbnailPreview" class="image-preview" style="display: none;">
                                <img id="thumbnailPreviewImg" src="" alt="Preview">
                                <div class="image-info">
                                    <span class="image-filename" id="thumbnailFilename"></span>
                                    <span class="image-size" id="thumbnailSize"></span>
                                    <button type="button" class="remove-image-btn" onclick="removeImage('thumbnail')">√ó
                                        Ï†úÍ±∞</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="descriptions-section">
                        <div class="section-title">Direction Section (ÏÑ†ÌÉùÏÇ¨Ìï≠)</div>
                        <p style="font-size:12px;color:#666;margin-bottom:16px;">Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïù¥Ïóê ÌëúÏãúÎê† ÌîÑÎ°úÏ†ùÌä∏ Î∞©Ìñ•ÏÑ± ÏÑ§Î™ÖÏûÖÎãàÎã§. "Í∞ïÏ°∞ ÌÇ§ÏõåÎìú"Ïóê
                            ÏûÖÎ†•Ìïú
                            Îã®Ïñ¥Í∞Ä Í≥®ÎìúÏÉâÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§.</p>

                        <div class="form-group">
                            <label for="directionMain">Direction Î©îÏù∏ ÏÑ§Î™Ö</label>
                            <textarea id="directionMain" rows="3"
                                placeholder="Ïòà: Ïã§Î¨¥ÏßÑÍ≥ºÏùò Ïù∏ÌÑ∞Î∑∞Î•º ÌÜµÌï¥ Í∞úÏÑ† Î∞©Ìñ•ÏùÑ Íµ¨Ï≤¥ÌôîÌïòÎäî Í≥ºÏ†ïÏùÑ Í±∞Ï≥§ÏäµÎãàÎã§."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Í∞ïÏ°∞ ÌÇ§ÏõåÎìú (Î©îÏù∏ ÏÑ§Î™ÖÏóêÏÑú Í∞ïÏ°∞Ìï† Îã®Ïñ¥)</label>
                            <input type="text" id="directionKeyword" placeholder="Ïòà: ÏÜåÎπÑÏûê¬∑Ïö¥ÏòÅ¬∑Î∏åÎûúÎìú"
                                style="margin-bottom:4px;">
                            <p style="font-size:11px;color:#999;">ÏúÑ Î©îÏù∏ ÏÑ§Î™ÖÏóê Ìè¨Ìï®Îêú Îã®Ïñ¥Î•º ÏûÖÎ†•ÌïòÎ©¥ Í≥®ÎìúÏÉâÏúºÎ°ú Í∞ïÏ°∞Îê©ÎãàÎã§</p>
                        </div>

                        <div class="form-group">
                            <label>Direction Ìï≠Î™© (ÏµúÎåÄ 3Í∞ú)</label>
                            <div
                                style="display:grid;grid-template-columns:120px 1fr;gap:8px;margin-bottom:8px;align-items:center;">
                                <input type="text" id="directionItem1Key" placeholder="Í∞ïÏ°∞ ÌÇ§ÏõåÎìú" style="font-size:13px;">
                                <input type="text" id="directionItem1Text"
                                    placeholder="ÏÑ§Î™Ö ÌÖçÏä§Ìä∏ (Ïòà: ÏõêÌïòÎäî Ï†úÌíàÏùÑ Ï∞æÏùÑ Ïàò ÏûàÍ≤å ÌïòÍ≥† Ïã∂Ïñ¥Ïöî)">
                            </div>
                            <div
                                style="display:grid;grid-template-columns:120px 1fr;gap:8px;margin-bottom:8px;align-items:center;">
                                <input type="text" id="directionItem2Key" placeholder="Í∞ïÏ°∞ ÌÇ§ÏõåÎìú" style="font-size:13px;">
                                <input type="text" id="directionItem2Text" placeholder="ÏÑ§Î™Ö ÌÖçÏä§Ìä∏">
                            </div>
                            <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center;">
                                <input type="text" id="directionItem3Key" placeholder="Í∞ïÏ°∞ ÌÇ§ÏõåÎìú" style="font-size:13px;">
                                <input type="text" id="directionItem3Text" placeholder="ÏÑ§Î™Ö ÌÖçÏä§Ìä∏">
                            </div>
                        </div>
                    </div>

                    <div class="descriptions-section">
                        <div class="section-title">Î≥∏Î¨∏ Ïù¥ÎØ∏ÏßÄ (ÏÑ†ÌÉùÏÇ¨Ìï≠)</div>

                        <div class="form-group">
                            <label for="additionalImages">Ï∂îÍ∞Ä Ïù¥ÎØ∏ÏßÄ (ÏµúÎåÄ 5Ïû•)</label>
                            <div class="file-input-wrapper">
                                <label for="additionalImages" class="file-input-label" id="additionalImagesLabel">
                                    <span class="upload-icon">üìé</span>
                                    <span class="upload-text">Ïó¨Îü¨ Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù Í∞ÄÎä• (ÏµúÎåÄ 5Ïû•)</span>
                                </label>
                                <input type="file" id="additionalImages" accept="image/*" multiple>
                            </div>
                            <div id="additionalImagesPreview" class="additional-images-preview"></div>
                        </div>
                    </div>

                    <div class="descriptions-section">
                        <div class="section-title">Links (Optional)</div>

                        <div class="form-group">
                            <label for="homepageUrl">Homepage URL</label>
                            <input type="url" id="homepageUrl">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="instagramUrl">Instagram</label>
                                <input type="url" id="instagramUrl">
                            </div>

                            <div class="form-group">
                                <label for="facebookUrl">Facebook</label>
                                <input type="url" id="facebookUrl">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="youtubeUrl">YouTube</label>
                                <input type="url" id="youtubeUrl">
                            </div>

                            <div class="form-group">
                                <label for="blogUrl">Blog</label>
                                <input type="url" id="blogUrl">
                            </div>
                        </div>

                        <div class="descriptions-section">
                            <div class="section-title">ÏûëÏÑ±Ïûê Ï†ïÎ≥¥</div>

                            <div class="form-group">
                                <label for="author">ÏûëÏÑ±Ïûê Ïù¥Î¶Ñ *</label>
                                <input type="text" id="author" required placeholder="ÌôçÍ∏∏Îèô">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn">Submit for Approval</button>
                </form>
            </div>
        </div>

        <!-- Live Preview Panel -->
        <div class="preview-panel">
            <div class="preview-header">
                <div class="preview-dot"></div>
                <span>Live Preview</span>
            </div>
            <div class="preview-content" id="previewContent">
                <div class="preview-empty" id="previewEmpty">
                    <div class="preview-empty-icon">üìù</div>
                    <div class="preview-empty-text">ÏôºÏ™Ω ÏñëÏãùÏóê ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÎ©¥<br>Ïó¨Í∏∞ÏÑú ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä ÌëúÏãúÎê©ÎãàÎã§</div>
                </div>
                <div id="previewData" style="display:none;">
                    <img id="previewImage" class="preview-image" style="display:none;" alt="Ïç∏ÎÑ§Ïùº ÎØ∏Î¶¨Î≥¥Í∏∞">
                    <h1 class="preview-title" id="previewTitle">Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</h1>
                    <div class="preview-meta">
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Client</span>
                            <span class="preview-meta-value" id="previewClient">-</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Category</span>
                            <span class="preview-meta-value" id="previewCategory">-</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Year</span>
                            <span class="preview-meta-value" id="previewYear">-</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Type</span>
                            <span class="preview-meta-value" id="previewType">-</span>
                        </div>
                    </div>
                    <div class="preview-desc" id="previewDesc"></div>
                    <div class="preview-metrics" id="previewMetrics" style="display:none;">
                        <div class="preview-metrics-title">Ï£ºÏöî ÏÑ±Í≥º ÏßÄÌëú</div>
                        <div id="previewMetricsList"></div>
                    </div>
                    <div class="preview-direction" id="previewDirection" style="display:none;">
                        <div class="preview-direction-label">DIRECTION</div>
                        <div class="preview-direction-main" id="previewDirectionMain"></div>
                        <div class="preview-direction-items" id="previewDirectionItems"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function goToHome() {
            console.log('goToHome called!');
            if (confirm('Ï†ÄÏû•Îêú Ï†ïÎ≥¥Îäî ÏßÄÏõåÏßÄÍ≥† ÎèåÏïÑÍ∞ÄÍ≤å Îê©ÎãàÎã§.\nÌôàÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                console.log('Redirecting to index.html');
                window.location.href = '../index.html';
            } else {
                console.log('User cancelled');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const logoElement = document.querySelector('.home-logo');
            if (logoElement) {
                logoElement.addEventListener('click', goToHome);
                console.log('Logo click event attached');
            }

            // Live Preview Update Function
            function updatePreview() {
                const title = document.getElementById('title').value.trim();
                const client = document.getElementById('client').value.trim();
                const category = document.getElementById('category').value;
                const year = document.getElementById('year').value.trim();
                const projectType = document.getElementById('projectType').value.trim();
                const description = document.getElementById('description1').value.trim();

                // Direction fields
                const directionMain = document.getElementById('directionMain').value.trim();
                const directionKeyword = document.getElementById('directionKeyword').value.trim();
                const item1Key = document.getElementById('directionItem1Key').value.trim();
                const item1Text = document.getElementById('directionItem1Text').value.trim();
                const item2Key = document.getElementById('directionItem2Key').value.trim();
                const item2Text = document.getElementById('directionItem2Text').value.trim();
                const item3Key = document.getElementById('directionItem3Key').value.trim();
                const item3Text = document.getElementById('directionItem3Text').value.trim();

                // Show/hide empty state
                const hasContent = title || client || category || description || directionMain;
                document.getElementById('previewEmpty').style.display = hasContent ? 'none' : 'block';
                document.getElementById('previewData').style.display = hasContent ? 'block' : 'none';

                // Update basic fields
                document.getElementById('previewTitle').textContent = title || 'Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî';
                document.getElementById('previewClient').textContent = client || '-';
                document.getElementById('previewCategory').textContent = category || '-';
                document.getElementById('previewYear').textContent = year || '-';
                document.getElementById('previewType').textContent = projectType || '-';
                document.getElementById('previewDesc').textContent = description || '';

                // Update Direction section
                const hasDirection = directionMain || item1Text || item2Text || item3Text;
                document.getElementById('previewDirection').style.display = hasDirection ? 'block' : 'none';

                if (hasDirection) {
                    // Main text with highlighted keyword
                    let mainHtml = directionMain;
                    if (directionKeyword && directionMain.includes(directionKeyword)) {
                        mainHtml = directionMain.replace(directionKeyword, `<strong>${directionKeyword}</strong>`);
                    }
                    document.getElementById('previewDirectionMain').innerHTML = mainHtml;

                    // Build items
                    let itemsHtml = '';
                    let itemNum = 1;
                    if (item1Text) {
                        const keyHtml = item1Key ? `<strong>${item1Key}</strong> ` : '';
                        itemsHtml += `<div class="preview-direction-item"><span class="num">${itemNum}</span><span>${keyHtml}${item1Text}</span></div>`;
                        itemNum++;
                    }
                    if (item2Text) {
                        const keyHtml = item2Key ? `<strong>${item2Key}</strong> ` : '';
                        itemsHtml += `<div class="preview-direction-item"><span class="num">${itemNum}</span><span>${keyHtml}${item2Text}</span></div>`;
                        itemNum++;
                    }
                    if (item3Text) {
                        const keyHtml = item3Key ? `<strong>${item3Key}</strong> ` : '';
                        itemsHtml += `<div class="preview-direction-item"><span class="num">${itemNum}</span><span>${keyHtml}${item3Text}</span></div>`;
                    }
                    document.getElementById('previewDirectionItems').innerHTML = itemsHtml;
                }

                // Update Metrics section
                const metricsContainer = document.getElementById('metricsContainer');
                const metricRows = metricsContainer ? metricsContainer.querySelectorAll('.metric-row') : [];
                let metricsHtml = '';
                let hasMetrics = false;

                metricRows.forEach(row => {
                    const typeSelect = row.querySelector('.metric-type');
                    const valueInput = row.querySelector('.metric-value');
                    if (typeSelect && valueInput) {
                        const type = typeSelect.value;
                        const value = valueInput.value.trim();
                        if (type && value) {
                            hasMetrics = true;
                            metricsHtml += `<div class="preview-metric-item">
                                <span class="preview-metric-type">${type}</span>
                                <span class="preview-metric-value">${value}</span>
                            </div>`;
                        }
                    }
                });

                document.getElementById('previewMetrics').style.display = hasMetrics ? 'block' : 'none';
                document.getElementById('previewMetricsList').innerHTML = metricsHtml;
            }

            // Thumbnail preview update function
            function updateThumbnailPreview(file) {
                const previewImg = document.getElementById('previewImage');
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewImg.src = e.target.result;
                        previewImg.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewImg.style.display = 'none';
                }
            }

            // Listen for thumbnail changes
            const thumbnailInput = document.getElementById('thumbnailImage');
            if (thumbnailInput) {
                thumbnailInput.addEventListener('change', function (e) {
                    if (e.target.files && e.target.files[0]) {
                        updateThumbnailPreview(e.target.files[0]);
                    }
                });
            }

            // Listen for metric changes (using event delegation)
            const metricsContainer = document.getElementById('metricsContainer');
            if (metricsContainer) {
                metricsContainer.addEventListener('input', updatePreview);
                metricsContainer.addEventListener('change', updatePreview);
            }

            // Attach event listeners to all input fields
            const fieldsToWatch = [
                'title', 'client', 'category', 'year', 'projectType', 'description1',
                'directionMain', 'directionKeyword',
                'directionItem1Key', 'directionItem1Text',
                'directionItem2Key', 'directionItem2Text',
                'directionItem3Key', 'directionItem3Text'
            ];

            fieldsToWatch.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updatePreview);
                    field.addEventListener('change', updatePreview);
                }
            });

            // Initial update
            updatePreview();
        });

        // Metric management functions
        function addMetric() {
            const container = document.getElementById('metricsContainer');
            const newRow = document.createElement('div');
            newRow.className = 'metric-row';
            newRow.innerHTML = `
                <select class="metric-type">
                    <option value="">ÏßÄÌëú ÏÑ†ÌÉù</option>
                    <option value="ROAS">ROAS (Í¥ëÍ≥† Ìà¨Ïûê ÏàòÏùµÎ•†)</option>
                    <option value="Ï°∞ÌöåÏàò">Ï°∞ÌöåÏàò</option>
                    <option value="Ïù¥Î≤§Ìä∏ Ï∞∏Ïó¨Ïûê">Ïù¥Î≤§Ìä∏ Ï∞∏Ïó¨Ïûê Ïàò</option>
                    <option value="Ï†ÑÌôòÏú®">Ï†ÑÌôòÏú® (%)</option>
                    <option value="ÌÅ¥Î¶≠Î•†">ÌÅ¥Î¶≠Î•† (CTR %)</option>
                    <option value="ÎèÑÎã¨">ÎèÑÎã¨ Ïàò</option>
                    <option value="Ï∞∏Ïó¨Ïú®">Ï∞∏Ïó¨Ïú® (%)</option>
                    <option value="Íµ¨Îß§ Ï†ÑÌôò">Íµ¨Îß§ Ï†ÑÌôò Ïàò</option>
                    <option value="Îß§Ï∂ú">Îß§Ï∂ú Ï¶ùÍ∞ÄÏú® (%)</option>
                    <option value="Ìä∏ÎûòÌîΩ">ÏõπÏÇ¨Ïù¥Ìä∏ Ìä∏ÎûòÌîΩ Ï¶ùÍ∞Ä (%)</option>
                    <option value="Î∏åÎûúÎìú Ïñ∏Í∏â">Î∏åÎûúÎìú Ïñ∏Í∏âÎüâ Ï¶ùÍ∞Ä (%)</option>
                    <option value="ÌåîÎ°úÏõå">ÌåîÎ°úÏõå Ï¶ùÍ∞Ä Ïàò</option>
                </select>
                <input type="text" class="metric-value" placeholder="ÏàòÏπò ÏûÖÎ†• (Ïòà: 450, 3.2)">
                <button type="button" class="remove-metric-btn" onclick="removeMetric(this)">√ó</button>
            `;
            container.appendChild(newRow);
        }

        function removeMetric(button) {
            const container = document.getElementById('metricsContainer');
            if (container.children.length > 1) {
                button.closest('.metric-row').remove();
            } else {
                alert('ÏµúÏÜå 1Í∞úÏùò ÏÑ±Í≥º ÏßÄÌëúÎäî Ïú†ÏßÄÌï¥Ïïº Ìï©ÎãàÎã§.');
            }
        }

        // Image preview functionality
        document.addEventListener('DOMContentLoaded', function () {
            const thumbnailInput = document.getElementById('thumbnail');

            thumbnailInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        document.getElementById('thumbnailPreviewImg').src = event.target.result;
                        document.getElementById('thumbnailFilename').textContent = file.name;
                        document.getElementById('thumbnailSize').textContent = formatFileSize(file.size);
                        document.getElementById('thumbnailPreview').style.display = 'block';
                        document.getElementById('thumbnailLabel').classList.add('has-file');
                        document.querySelector('#thumbnailLabel .upload-icon').textContent = '‚úì';
                        document.querySelector('#thumbnailLabel .upload-text').textContent = 'Ïù¥ÎØ∏ÏßÄ Ï≤®Î∂Ä ÏôÑÎ£å';
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        function removeImage(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            document.getElementById(inputId + 'Preview').style.display = 'none';
            document.getElementById(inputId + 'Label').classList.remove('has-file');
            document.querySelector('#' + inputId + 'Label .upload-icon').textContent = 'üìé';
            document.querySelector('#' + inputId + 'Label .upload-text').textContent = 'Choose file or drag here';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Additional images handling
        let additionalImagesFiles = [];

        document.addEventListener('DOMContentLoaded', function () {
            const additionalImagesInput = document.getElementById('additionalImages');

            additionalImagesInput.addEventListener('change', function (e) {
                const files = Array.from(e.target.files);
                const maxFiles = 5;

                if (files.length + additionalImagesFiles.length > maxFiles) {
                    alert(`ÏµúÎåÄ ${maxFiles}Ïû•ÍπåÏßÄÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.`);
                    return;
                }

                files.forEach(file => {
                    if (additionalImagesFiles.length < maxFiles) {
                        additionalImagesFiles.push(file);
                    }
                });

                renderAdditionalImages();
                updateAdditionalImagesLabel();

                // Clear input for next selection
                e.target.value = '';
            });
        });

        function renderAdditionalImages() {
            const container = document.getElementById('additionalImagesPreview');
            container.innerHTML = '';

            additionalImagesFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const div = document.createElement('div');
                    div.className = 'additional-image-item';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="additional-image-info">${file.name}</div>
                        <div class="additional-image-info">${formatFileSize(file.size)}</div>
                        <button type="button" class="additional-image-remove" onclick="removeAdditionalImage(${index})">√ó Ï†úÍ±∞</button>
                    `;
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeAdditionalImage(index) {
            additionalImagesFiles.splice(index, 1);
            renderAdditionalImages();
            updateAdditionalImagesLabel();
        }

        function updateAdditionalImagesLabel() {
            const label = document.getElementById('additionalImagesLabel');
            const count = additionalImagesFiles.length;

            if (count > 0) {
                label.classList.add('has-file');
                label.querySelector('.upload-icon').textContent = '‚úì';
                label.querySelector('.upload-text').innerHTML = `Ïù¥ÎØ∏ÏßÄ ${count}Ïû• Ï≤®Î∂ÄÎê® <span class="image-count-badge">${count}/5</span>`;
            } else {
                label.classList.remove('has-file');
                label.querySelector('.upload-icon').textContent = 'üìé';
                label.querySelector('.upload-text').textContent = 'Ïó¨Îü¨ Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù Í∞ÄÎä• (ÏµúÎåÄ 5Ïû•)';
            }
        }
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBeZGgTw8zJoYz26PUfk3xoU-83oMD3v_M",
            authDomain: "hivemedia-archive.firebaseapp.com",
            projectId: "hivemedia-archive",
            storageBucket: "hivemedia-archive.appspot.com",
            messagingSenderId: "305221975765",
            appId: "1:305221975765:web:5d6c8b980e47087f941f17"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Simple session check
        const userRole = sessionStorage.getItem('userRole');
        const userId = sessionStorage.getItem('userId');
        if (!userRole) {
            window.location.href = 'login.html';
        }

        const portfolioForm = document.getElementById('portfolioForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMsg = document.getElementById('successMsg');

        portfolioForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            console.log('Form submitted');

            // Check if logged in
            if (!userId) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                window.location.href = 'login.html';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                // Collect metrics from all metric rows
                const metricRows = document.querySelectorAll('.metric-row');
                const metrics = [];
                metricRows.forEach(row => {
                    const type = row.querySelector('.metric-type').value;
                    const value = row.querySelector('.metric-value').value.trim();
                    if (type && value) {
                        metrics.push({ type, value });
                    }
                });

                // Get project overview (description1)
                const description = document.getElementById('description1').value.trim();

                // Format period from date fields
                const periodStart = document.getElementById('periodStart').value;
                const periodEnd = document.getElementById('periodEnd').value;
                let period = '';
                if (periodStart && periodEnd) {
                    period = `${periodStart} ~ ${periodEnd}`;
                } else if (periodStart) {
                    period = periodStart;
                }

                // Convert thumbnail to Base64 (no Firebase Storage needed)
                const thumbnailFile = document.getElementById('thumbnail').files[0];
                if (!thumbnailFile) {
                    alert('Ïç∏ÎÑ§Ïùº Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                // Check file type
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                if (!validTypes.includes(thumbnailFile.type)) {
                    alert('Ïù¥ÎØ∏ÏßÄ ÌòïÏãù Ïò§Î•ò\n\nÏßÄÏõêÎêòÎäî ÌòïÏãù: JPG, PNG, GIF, WebP\nÏÑ†ÌÉùÌïú ÌååÏùº: ' + thumbnailFile.type);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                // Check file size (max 10MB for original file)
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (thumbnailFile.size > maxSize) {
                    alert('ÌååÏùº Ïö©Îüâ Ï¥àÍ≥º\n\nÏµúÎåÄ Ïö©Îüâ: 10MB\nÏÑ†ÌÉùÌïú ÌååÏùº: ' + Math.round(thumbnailFile.size / 1024 / 1024) + 'MB\n\nÎçî ÏûëÏùÄ Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                console.log('Compressing and converting image...');

                let thumbnailUrl;
                try {
                    // Resize and compress image to keep under 1MB
                    thumbnailUrl = await new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');

                            // Max dimensions (Reduced to stay within 1MB Firestore limit)
                            const MAX_WIDTH = 1000;
                            const MAX_HEIGHT = 1000;

                            let width = img.width;
                            let height = img.height;

                            if (width > height) {
                                if (width > MAX_WIDTH) {
                                    height *= MAX_WIDTH / width;
                                    width = MAX_WIDTH;
                                }
                            } else {
                                if (height > MAX_HEIGHT) {
                                    width *= MAX_HEIGHT / height;
                                    height = MAX_HEIGHT;
                                }
                            }

                            canvas.width = width;
                            canvas.height = height;
                            ctx.drawImage(img, 0, 0, width, height);

                            // Convert with compression (0.6 quality for better safety)
                            resolve(canvas.toDataURL('image/jpeg', 0.6));
                        };
                        img.onerror = () => reject(new Error('Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®'));
                        img.src = URL.createObjectURL(thumbnailFile);
                    });

                    const compressedSizeKB = Math.round(thumbnailUrl.length / 1024);
                    console.log('Image compressed, size:', compressedSizeKB, 'KB');

                    // Check if compressed size is still too large (Firestore limit is 1MB total)
                    if (compressedSizeKB > 900) {
                        alert('Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï ÌõÑÏóêÎèÑ Ïö©ÎüâÏù¥ ÎÑàÎ¨¥ ÌÅΩÎãàÎã§ (ÏïΩ ' + compressedSizeKB + 'KB).\n\nÌååÏù¥Ïñ¥Î≤†Ïù¥Ïä§ Ï†ÄÏû• Ï†úÌïú(1MB)ÏùÑ ÎßûÏ∂îÍ∏∞ ÏúÑÌï¥\nÌï¥ÏÉÅÎèÑÍ∞Ä Îçî ÎÇÆÍ±∞ÎÇò Ïö©ÎüâÏù¥ ÏûëÏùÄ Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Submit for Approval';
                        return;
                    }
                } catch (imageError) {
                    console.error('Image processing error:', imageError);
                    alert('Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ Ïò§Î•ò\n\n' + imageError.message + '\n\nÎã§Î•∏ Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                // Process additional images
                const additionalImageUrls = [];
                if (additionalImagesFiles.length > 0) {
                    console.log(`Processing ${additionalImagesFiles.length} additional images...`);
                    for (const file of additionalImagesFiles) {
                        try {
                            const imgUrl = await new Promise((resolve, reject) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    const MAX_WIDTH = 800;
                                    const MAX_HEIGHT = 800;
                                    let width = img.width;
                                    let height = img.height;
                                    if (width > height) {
                                        if (width > MAX_WIDTH) {
                                            height *= MAX_WIDTH / width;
                                            width = MAX_WIDTH;
                                        }
                                    } else {
                                        if (height > MAX_HEIGHT) {
                                            width *= MAX_HEIGHT / height;
                                            height = MAX_HEIGHT;
                                        }
                                    }
                                    canvas.width = width;
                                    canvas.height = height;
                                    ctx.drawImage(img, 0, 0, width, height);
                                    resolve(canvas.toDataURL('image/jpeg', 0.5));
                                };
                                img.onerror = () => reject(new Error('Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®'));
                                img.src = URL.createObjectURL(file);
                            });

                            if (imgUrl.length / 1024 < 400) {
                                additionalImageUrls.push(imgUrl);
                            }
                        } catch (err) {
                            console.error('Additional image processing error:', err);
                        }
                    }
                }

                // Build directions array (if any direction fields are filled)
                const directionMain = document.getElementById('directionMain').value.trim();
                const directionKeyword = document.getElementById('directionKeyword').value.trim();

                // Get item key/text pairs
                const item1Key = document.getElementById('directionItem1Key').value.trim();
                const item1Text = document.getElementById('directionItem1Text').value.trim();
                const item2Key = document.getElementById('directionItem2Key').value.trim();
                const item2Text = document.getElementById('directionItem2Text').value.trim();
                const item3Key = document.getElementById('directionItem3Key').value.trim();
                const item3Text = document.getElementById('directionItem3Text').value.trim();

                // Helper function to wrap keyword with strong tag
                function wrapKeyword(text, keyword) {
                    if (!keyword || !text) return text;
                    return text.replace(keyword, `<strong>${keyword}</strong>`);
                }

                // Build main text with highlighted keyword
                let mainText = directionMain;
                if (directionKeyword && directionMain) {
                    mainText = wrapKeyword(directionMain, directionKeyword);
                }

                // Build items array with highlighted keywords
                const items = [];
                if (item1Text) {
                    items.push(item1Key ? `<strong>${item1Key}</strong> ${item1Text}` : item1Text);
                }
                if (item2Text) {
                    items.push(item2Key ? `<strong>${item2Key}</strong> ${item2Text}` : item2Text);
                }
                if (item3Text) {
                    items.push(item3Key ? `<strong>${item3Key}</strong> ${item3Text}` : item3Text);
                }

                let directions = [];
                if (directionMain || items.length > 0) {
                    directions = [{
                        label: 'DIRECTION',
                        main: mainText,
                        items: items
                    }];
                }

                // Create portfolio document
                const portfolioData = {
                    title: document.getElementById('title').value,
                    category: document.getElementById('category').value,
                    client: document.getElementById('client').value,
                    advertiser: document.getElementById('client').value,
                    projectType: document.getElementById('projectType').value,
                    year: document.getElementById('year').value,
                    subtitle: document.getElementById('subtitle').value,
                    description: description,
                    directions: directions,
                    metrics: metrics,
                    period: period,
                    author: document.getElementById('author').value,
                    thumbnailUrl: thumbnailUrl,
                    imageUrl: thumbnailUrl,
                    images: [thumbnailUrl, ...additionalImageUrls],
                    homepageUrl: document.getElementById('homepageUrl').value,
                    instagramUrl: document.getElementById('instagramUrl').value,
                    facebookUrl: document.getElementById('facebookUrl').value,
                    youtubeUrl: document.getElementById('youtubeUrl').value,
                    blogUrl: document.getElementById('blogUrl').value,
                    status: 'pending',
                    createdBy: userId,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                console.log('Saving to Firestore...', portfolioData);
                await addDoc(collection(db, 'portfolios'), portfolioData);
                console.log('Successfully saved to Firestore');

                // Success message
                successMsg.textContent = '‚úÖ Ìè¨Ìä∏Ìè¥Î¶¨Ïò§Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§! Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÌéòÏù¥ÏßÄÏóê ÌëúÏãúÎê©ÎãàÎã§.';
                successMsg.classList.add('show');
                portfolioForm.reset();

                // Show alert
                alert('Ï†úÏ∂ú ÏôÑÎ£å!\n\nÌè¨Ìä∏Ìè¥Î¶¨Ïò§Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§.\nÍ¥ÄÎ¶¨ÏûêÏùò ÏäπÏù∏ ÌõÑ Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÌéòÏù¥ÏßÄÏóê Í≤åÏãúÎê©ÎãàÎã§.');

                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 8000);

            } catch (error) {
                console.error('Submission error:', error);

                // Detailed error messages
                let errorMessage = 'Ï†úÏ∂ú Ïã§Ìå®: ';

                if (error.code === 'storage/unauthorized') {
                    errorMessage += 'ÌååÏùº ÏóÖÎ°úÎìú Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. Firebase Storage ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                } else if (error.code === 'permission-denied') {
                    errorMessage += 'Firestore Ïì∞Í∏∞ Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. Firebase Î≥¥Ïïà Í∑úÏπôÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                } else if (error.message.includes('network')) {
                    errorMessage += 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                } else if (error.message.includes('storage')) {
                    errorMessage += 'Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÌååÏùº ÌÅ¨Í∏∞ÎÇò ÌòïÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                } else {
                    errorMessage += error.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                }

                alert(errorMessage + '\n\nÏÉÅÏÑ∏ Ïò§Î•ò:\n' + error.toString());
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit for Approval';
            }
        });
    </script>
</body>

</html>