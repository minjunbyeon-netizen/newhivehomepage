<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Writing - HiveMedia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: white;
            border-bottom: 1px solid #eee;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .back-btn {
            background: transparent;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            text-decoration: none;
            color: #1a1a1a;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        .form-card {
            background: white;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .form-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .form-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 32px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #1a1a1a;
            font-size: 14px;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .file-input-wrapper {
            position: relative;
        }

        .file-input-label {
            display: block;
            padding: 12px;
            background: #f5f5f5;
            border: 1px dashed #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .file-input-label:hover {
            background: #eee;
        }

        input[type="file"] {
            display: none;
        }

        .submit-btn {
            width: 100%;
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 16px;
        }

        .submit-btn:hover {
            background: #333;
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .success-msg {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 20px;
            display: none;
        }

        .success-msg.show {
            display: block;
        }

        .descriptions-section {
            border-top: 1px solid #eee;
            padding-top: 24px;
            margin-top: 24px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        /* Logo Redirect Style */
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .home-logo {
            cursor: pointer;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
        }

        .home-logo:hover {
            opacity: 0.8;
        }

        .home-logo img {
            height: 24px;
            width: auto;
        }

        /* Metrics Section */
        .metric-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }

        .metric-type,
        .metric-value {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .metric-type:focus,
        .metric-value:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .remove-metric-btn {
            width: 36px;
            height: 36px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 20px;
            line-height: 1;
            transition: all 0.2s;
        }

        .remove-metric-btn:hover {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
        }

        .add-metric-btn {
            display: inline-block;
            padding: 10px 16px;
            background: #f5f5f5;
            border: 1px dashed #ddd;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .add-metric-btn:hover {
            background: #eee;
            border-color: #1a1a1a;
        }

        /* Image Upload Styles */
        .upload-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 8px;
        }

        .upload-text {
            display: block;
            font-size: 14px;
        }

        .file-input-label.has-file {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .image-preview {
            margin-top: 16px;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            margin-bottom: 12px;
            display: block;
        }

        .image-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .image-filename {
            font-size: 14px;
            font-weight: 500;
            color: #1a1a1a;
            flex: 1;
        }

        .image-size {
            font-size: 12px;
            color: #666;
            padding: 4px 8px;
            background: #fff;
            border-radius: 4px;
        }

        .remove-image-btn {
            padding: 6px 12px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .remove-image-btn:hover {
            background: #cc0000;
        }

        /* Additional Images Preview */
        .additional-images-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .additional-image-item {
            position: relative;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 8px;
        }

        .additional-image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .additional-image-info {
            font-size: 11px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: 8px;
        }

        .additional-image-remove {
            width: 100%;
            padding: 4px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .additional-image-remove:hover {
            background: #cc0000;
        }

        .image-count-badge {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 8px;
            background: #1a1a1a;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="header-left">
            <div class="home-logo">
                <img src="../assets/img/logo_img_b.png" alt="HiveMedia">
            </div>
            <h1>Portfolio Writing</h1>
        </div>
        <a href="dashboard.html" class="back-btn">Back to Dashboard</a>
    </div>

    <div class="container">
        <div class="form-card">
            <h2 class="form-title">New Portfolio Item</h2>
            <p class="form-subtitle">Create a new portfolio entry</p>

            <div class="success-msg" id="successMsg"></div>

            <form id="portfolioForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="title">Title *</label>
                        <input type="text" id="title" required>
                    </div>

                    <div class="form-group">
                        <label for="category">Category *</label>
                        <select id="category" required>
                            <option value="">Select category</option>
                            <option value="Online AD">Online AD</option>
                            <option value="SNS">SNS</option>
                            <option value="Homepage">Homepage</option>
                            <option value="Eventpage">Eventpage</option>
                            <option value="Video">Video</option>
                            <option value="Print">Print</option>
                            <option value="Exhibition Art">Exhibition Art</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="client">Client Name *</label>
                        <input type="text" id="client" required>
                    </div>

                    <div class="form-group">
                        <label for="periodStart">Period Start</label>
                        <input type="date" id="periodStart">
                    </div>

                    <div class="form-group">
                        <label for="periodEnd">Period End</label>
                        <input type="date" id="periodEnd">
                    </div>
                </div>

                <div class="form-group">
                    <label for="subtitle">Subtitle</label>
                    <input type="text" id="subtitle">
                </div>

                <div class="descriptions-section">
                    <div class="section-title">Project Descriptions</div>

                    <div class="form-group">
                        <label for="description1">í”„ë¡œì íŠ¸ ê°œìš” *</label>
                        <textarea id="description1" required
                            placeholder="ì˜ˆ: ë³¸ ìº í˜ì¸ì€ ì‹ ì œí’ˆ ëŸ°ì¹­ì„ ìœ„í•œ í†µí•© ë§ˆì¼€íŒ… í”„ë¡œì íŠ¸ë¡œ, SNS ê´‘ê³ ì™€ ì¸í”Œë£¨ì–¸ì„œ ë§ˆì¼€íŒ…ì„ ê²°í•©í•˜ì—¬ ë¸Œëœë“œ ì¸ì§€ë„ë¥¼ ë†’ì´ê³  êµ¬ë§¤ ì „í™˜ìœ¨ì„ ì¦ëŒ€ì‹œí‚¤ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="description2">ì£¼ìš” ì„±ê³¼ ì§€í‘œ</label>
                        <div id="metricsContainer">
                            <div class="metric-row">
                                <select class="metric-type">
                                    <option value="">ì§€í‘œ ì„ íƒ</option>
                                    <option value="ROAS">ROAS (ê´‘ê³  íˆ¬ì ìˆ˜ìµë¥ )</option>
                                    <option value="ì¡°íšŒìˆ˜">ì¡°íšŒìˆ˜</option>
                                    <option value="ì´ë²¤íŠ¸ ì°¸ì—¬ì">ì´ë²¤íŠ¸ ì°¸ì—¬ì ìˆ˜</option>
                                    <option value="ì „í™˜ìœ¨">ì „í™˜ìœ¨ (%)</option>
                                    <option value="í´ë¦­ë¥ ">í´ë¦­ë¥  (CTR %)</option>
                                    <option value="ë„ë‹¬">ë„ë‹¬ ìˆ˜</option>
                                    <option value="ì°¸ì—¬ìœ¨">ì°¸ì—¬ìœ¨ (%)</option>
                                    <option value="êµ¬ë§¤ ì „í™˜">êµ¬ë§¤ ì „í™˜ ìˆ˜</option>
                                    <option value="ë§¤ì¶œ">ë§¤ì¶œ ì¦ê°€ìœ¨ (%)</option>
                                    <option value="íŠ¸ë˜í”½">ì›¹ì‚¬ì´íŠ¸ íŠ¸ë˜í”½ ì¦ê°€ (%)</option>
                                    <option value="ë¸Œëœë“œ ì–¸ê¸‰">ë¸Œëœë“œ ì–¸ê¸‰ëŸ‰ ì¦ê°€ (%)</option>
                                    <option value="íŒ”ë¡œì›Œ">íŒ”ë¡œì›Œ ì¦ê°€ ìˆ˜</option>
                                </select>
                                <input type="text" class="metric-value" placeholder="ìˆ˜ì¹˜ ì…ë ¥ (ì˜ˆ: 450, 3.2)">
                                <button type="button" class="remove-metric-btn" onclick="removeMetric(this)">Ã—</button>
                            </div>
                        </div>
                        <button type="button" class="add-metric-btn" onclick="addMetric()">+ ì„±ê³¼ ì§€í‘œ ì¶”ê°€</button>
                    </div>
                </div>

                <div class="descriptions-section">
                    <div class="section-title">Images</div>

                    <div class="form-group">
                        <label for="thumbnail">Thumbnail Image *</label>
                        <div class="file-input-wrapper">
                            <label for="thumbnail" class="file-input-label" id="thumbnailLabel">
                                <span class="upload-icon">ğŸ“</span>
                                <span class="upload-text">Choose file or drag here</span>
                            </label>
                            <input type="file" id="thumbnail" accept="image/*" required>
                        </div>
                        <div id="thumbnailPreview" class="image-preview" style="display: none;">
                            <img id="thumbnailPreviewImg" src="" alt="Preview">
                            <div class="image-info">
                                <span class="image-filename" id="thumbnailFilename"></span>
                                <span class="image-size" id="thumbnailSize"></span>
                                <button type="button" class="remove-image-btn" onclick="removeImage('thumbnail')">Ã—
                                    ì œê±°</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="descriptions-section">
                    <div class="section-title">ë³¸ë¬¸ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)</div>

                    <div class="form-group">
                        <label for="additionalImages">ì¶”ê°€ ì´ë¯¸ì§€ (ìµœëŒ€ 5ì¥)</label>
                        <div class="file-input-wrapper">
                            <label for="additionalImages" class="file-input-label" id="additionalImagesLabel">
                                <span class="upload-icon">ğŸ“</span>
                                <span class="upload-text">ì—¬ëŸ¬ ì´ë¯¸ì§€ ì„ íƒ ê°€ëŠ¥ (ìµœëŒ€ 5ì¥)</span>
                            </label>
                            <input type="file" id="additionalImages" accept="image/*" multiple>
                        </div>
                        <div id="additionalImagesPreview" class="additional-images-preview"></div>
                    </div>
                </div>

                <div class="descriptions-section">
                    <div class="section-title">Links (Optional)</div>

                    <div class="form-group">
                        <label for="homepageUrl">Homepage URL</label>
                        <input type="url" id="homepageUrl">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="instagramUrl">Instagram</label>
                            <input type="url" id="instagramUrl">
                        </div>

                        <div class="form-group">
                            <label for="facebookUrl">Facebook</label>
                            <input type="url" id="facebookUrl">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="youtubeUrl">YouTube</label>
                            <input type="url" id="youtubeUrl">
                        </div>

                        <div class="form-group">
                            <label for="blogUrl">Blog</label>
                            <input type="url" id="blogUrl">
                        </div>
                    </div>

                    <div class="descriptions-section">
                        <div class="section-title">ì‘ì„±ì ì •ë³´</div>

                        <div class="form-group">
                            <label for="author">ì‘ì„±ì ì´ë¦„ *</label>
                            <input type="text" id="author" required placeholder="í™ê¸¸ë™">
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">Submit for Approval</button>
            </form>
        </div>
    </div>

    <script>
        function goToHome() {
            console.log('goToHome called!');
            if (confirm('ì €ì¥ëœ ì •ë³´ëŠ” ì§€ì›Œì§€ê³  ëŒì•„ê°€ê²Œ ë©ë‹ˆë‹¤.\ní™ˆí˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                console.log('Redirecting to index.html');
                window.location.href = '../index.html';
            } else {
                console.log('User cancelled');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const logoElement = document.querySelector('.home-logo');
            if (logoElement) {
                logoElement.addEventListener('click', goToHome);
                console.log('Logo click event attached');
            }
        });

        // Metric management functions
        function addMetric() {
            const container = document.getElementById('metricsContainer');
            const newRow = document.createElement('div');
            newRow.className = 'metric-row';
            newRow.innerHTML = `
                <select class="metric-type">
                    <option value="">ì§€í‘œ ì„ íƒ</option>
                    <option value="ROAS">ROAS (ê´‘ê³  íˆ¬ì ìˆ˜ìµë¥ )</option>
                    <option value="ì¡°íšŒìˆ˜">ì¡°íšŒìˆ˜</option>
                    <option value="ì´ë²¤íŠ¸ ì°¸ì—¬ì">ì´ë²¤íŠ¸ ì°¸ì—¬ì ìˆ˜</option>
                    <option value="ì „í™˜ìœ¨">ì „í™˜ìœ¨ (%)</option>
                    <option value="í´ë¦­ë¥ ">í´ë¦­ë¥  (CTR %)</option>
                    <option value="ë„ë‹¬">ë„ë‹¬ ìˆ˜</option>
                    <option value="ì°¸ì—¬ìœ¨">ì°¸ì—¬ìœ¨ (%)</option>
                    <option value="êµ¬ë§¤ ì „í™˜">êµ¬ë§¤ ì „í™˜ ìˆ˜</option>
                    <option value="ë§¤ì¶œ">ë§¤ì¶œ ì¦ê°€ìœ¨ (%)</option>
                    <option value="íŠ¸ë˜í”½">ì›¹ì‚¬ì´íŠ¸ íŠ¸ë˜í”½ ì¦ê°€ (%)</option>
                    <option value="ë¸Œëœë“œ ì–¸ê¸‰">ë¸Œëœë“œ ì–¸ê¸‰ëŸ‰ ì¦ê°€ (%)</option>
                    <option value="íŒ”ë¡œì›Œ">íŒ”ë¡œì›Œ ì¦ê°€ ìˆ˜</option>
                </select>
                <input type="text" class="metric-value" placeholder="ìˆ˜ì¹˜ ì…ë ¥ (ì˜ˆ: 450, 3.2)">
                <button type="button" class="remove-metric-btn" onclick="removeMetric(this)">Ã—</button>
            `;
            container.appendChild(newRow);
        }

        function removeMetric(button) {
            const container = document.getElementById('metricsContainer');
            if (container.children.length > 1) {
                button.closest('.metric-row').remove();
            } else {
                alert('ìµœì†Œ 1ê°œì˜ ì„±ê³¼ ì§€í‘œëŠ” ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
            }
        }

        // Image preview functionality
        document.addEventListener('DOMContentLoaded', function () {
            const thumbnailInput = document.getElementById('thumbnail');

            thumbnailInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        document.getElementById('thumbnailPreviewImg').src = event.target.result;
                        document.getElementById('thumbnailFilename').textContent = file.name;
                        document.getElementById('thumbnailSize').textContent = formatFileSize(file.size);
                        document.getElementById('thumbnailPreview').style.display = 'block';
                        document.getElementById('thumbnailLabel').classList.add('has-file');
                        document.querySelector('#thumbnailLabel .upload-icon').textContent = 'âœ“';
                        document.querySelector('#thumbnailLabel .upload-text').textContent = 'ì´ë¯¸ì§€ ì²¨ë¶€ ì™„ë£Œ';
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        function removeImage(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            document.getElementById(inputId + 'Preview').style.display = 'none';
            document.getElementById(inputId + 'Label').classList.remove('has-file');
            document.querySelector('#' + inputId + 'Label .upload-icon').textContent = 'ğŸ“';
            document.querySelector('#' + inputId + 'Label .upload-text').textContent = 'Choose file or drag here';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Additional images handling
        let additionalImagesFiles = [];

        document.addEventListener('DOMContentLoaded', function () {
            const additionalImagesInput = document.getElementById('additionalImages');

            additionalImagesInput.addEventListener('change', function (e) {
                const files = Array.from(e.target.files);
                const maxFiles = 5;

                if (files.length + additionalImagesFiles.length > maxFiles) {
                    alert(`ìµœëŒ€ ${maxFiles}ì¥ê¹Œì§€ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                    return;
                }

                files.forEach(file => {
                    if (additionalImagesFiles.length < maxFiles) {
                        additionalImagesFiles.push(file);
                    }
                });

                renderAdditionalImages();
                updateAdditionalImagesLabel();

                // Clear input for next selection
                e.target.value = '';
            });
        });

        function renderAdditionalImages() {
            const container = document.getElementById('additionalImagesPreview');
            container.innerHTML = '';

            additionalImagesFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const div = document.createElement('div');
                    div.className = 'additional-image-item';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="additional-image-info">${file.name}</div>
                        <div class="additional-image-info">${formatFileSize(file.size)}</div>
                        <button type="button" class="additional-image-remove" onclick="removeAdditionalImage(${index})">Ã— ì œê±°</button>
                    `;
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeAdditionalImage(index) {
            additionalImagesFiles.splice(index, 1);
            renderAdditionalImages();
            updateAdditionalImagesLabel();
        }

        function updateAdditionalImagesLabel() {
            const label = document.getElementById('additionalImagesLabel');
            const count = additionalImagesFiles.length;

            if (count > 0) {
                label.classList.add('has-file');
                label.querySelector('.upload-icon').textContent = 'âœ“';
                label.querySelector('.upload-text').innerHTML = `ì´ë¯¸ì§€ ${count}ì¥ ì²¨ë¶€ë¨ <span class="image-count-badge">${count}/5</span>`;
            } else {
                label.classList.remove('has-file');
                label.querySelector('.upload-icon').textContent = 'ğŸ“';
                label.querySelector('.upload-text').textContent = 'ì—¬ëŸ¬ ì´ë¯¸ì§€ ì„ íƒ ê°€ëŠ¥ (ìµœëŒ€ 5ì¥)';
            }
        }
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBeZGgTw8zJoYz26PUfk3xoU-83oMD3v_M",
            authDomain: "hivemedia-archive.firebaseapp.com",
            projectId: "hivemedia-archive",
            storageBucket: "hivemedia-archive.appspot.com",
            messagingSenderId: "305221975765",
            appId: "1:305221975765:web:5d6c8b980e47087f941f17"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Simple session check
        const userRole = sessionStorage.getItem('userRole');
        const userId = sessionStorage.getItem('userId');
        if (!userRole) {
            window.location.href = 'login.html';
        }

        const portfolioForm = document.getElementById('portfolioForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMsg = document.getElementById('successMsg');

        portfolioForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            console.log('Form submitted');

            // Check if logged in
            if (!userId) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                window.location.href = 'login.html';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                // Collect metrics from all metric rows
                const metricRows = document.querySelectorAll('.metric-row');
                const metrics = [];
                metricRows.forEach(row => {
                    const type = row.querySelector('.metric-type').value;
                    const value = row.querySelector('.metric-value').value.trim();
                    if (type && value) {
                        metrics.push({ type, value });
                    }
                });

                // Get project overview (description1)
                const description = document.getElementById('description1').value.trim();

                // Format period from date fields
                const periodStart = document.getElementById('periodStart').value;
                const periodEnd = document.getElementById('periodEnd').value;
                let period = '';
                if (periodStart && periodEnd) {
                    period = `${periodStart} ~ ${periodEnd}`;
                } else if (periodStart) {
                    period = periodStart;
                }

                // Convert thumbnail to Base64 (no Firebase Storage needed)
                const thumbnailFile = document.getElementById('thumbnail').files[0];
                if (!thumbnailFile) {
                    alert('ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                // Check file type
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                if (!validTypes.includes(thumbnailFile.type)) {
                    alert('ì´ë¯¸ì§€ í˜•ì‹ ì˜¤ë¥˜\n\nì§€ì›ë˜ëŠ” í˜•ì‹: JPG, PNG, GIF, WebP\nì„ íƒí•œ íŒŒì¼: ' + thumbnailFile.type);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                // Check file size (max 10MB for original file)
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (thumbnailFile.size > maxSize) {
                    alert('íŒŒì¼ ìš©ëŸ‰ ì´ˆê³¼\n\nìµœëŒ€ ìš©ëŸ‰: 10MB\nì„ íƒí•œ íŒŒì¼: ' + Math.round(thumbnailFile.size / 1024 / 1024) + 'MB\n\në” ì‘ì€ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                console.log('Compressing and converting image...');

                let thumbnailUrl;
                try {
                    // Resize and compress image to keep under 1MB
                    thumbnailUrl = await new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');

                            // Max dimensions (Reduced to stay within 1MB Firestore limit)
                            const MAX_WIDTH = 1000;
                            const MAX_HEIGHT = 1000;

                            let width = img.width;
                            let height = img.height;

                            if (width > height) {
                                if (width > MAX_WIDTH) {
                                    height *= MAX_WIDTH / width;
                                    width = MAX_WIDTH;
                                }
                            } else {
                                if (height > MAX_HEIGHT) {
                                    width *= MAX_HEIGHT / height;
                                    height = MAX_HEIGHT;
                                }
                            }

                            canvas.width = width;
                            canvas.height = height;
                            ctx.drawImage(img, 0, 0, width, height);

                            // Convert with compression (0.6 quality for better safety)
                            resolve(canvas.toDataURL('image/jpeg', 0.6));
                        };
                        img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
                        img.src = URL.createObjectURL(thumbnailFile);
                    });

                    const compressedSizeKB = Math.round(thumbnailUrl.length / 1024);
                    console.log('Image compressed, size:', compressedSizeKB, 'KB');

                    // Check if compressed size is still too large (Firestore limit is 1MB total)
                    if (compressedSizeKB > 900) {
                        alert('ì´ë¯¸ì§€ ì••ì¶• í›„ì—ë„ ìš©ëŸ‰ì´ ë„ˆë¬´ í½ë‹ˆë‹¤ (ì•½ ' + compressedSizeKB + 'KB).\n\níŒŒì´ì–´ë² ì´ìŠ¤ ì €ì¥ ì œí•œ(1MB)ì„ ë§ì¶”ê¸° ìœ„í•´\ní•´ìƒë„ê°€ ë” ë‚®ê±°ë‚˜ ìš©ëŸ‰ì´ ì‘ì€ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Submit for Approval';
                        return;
                    }
                } catch (imageError) {
                    console.error('Image processing error:', imageError);
                    alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜\n\n' + imageError.message + '\n\në‹¤ë¥¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê±°ë‚˜ íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit for Approval';
                    return;
                }

                // Process additional images
                const additionalImageUrls = [];
                if (additionalImagesFiles.length > 0) {
                    console.log(`Processing ${additionalImagesFiles.length} additional images...`);
                    for (const file of additionalImagesFiles) {
                        try {
                            const imgUrl = await new Promise((resolve, reject) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    const MAX_WIDTH = 800;
                                    const MAX_HEIGHT = 800;
                                    let width = img.width;
                                    let height = img.height;
                                    if (width > height) {
                                        if (width > MAX_WIDTH) {
                                            height *= MAX_WIDTH / width;
                                            width = MAX_WIDTH;
                                        }
                                    } else {
                                        if (height > MAX_HEIGHT) {
                                            width *= MAX_HEIGHT / height;
                                            height = MAX_HEIGHT;
                                        }
                                    }
                                    canvas.width = width;
                                    canvas.height = height;
                                    ctx.drawImage(img, 0, 0, width, height);
                                    resolve(canvas.toDataURL('image/jpeg', 0.5));
                                };
                                img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
                                img.src = URL.createObjectURL(file);
                            });

                            if (imgUrl.length / 1024 < 400) {
                                additionalImageUrls.push(imgUrl);
                            }
                        } catch (err) {
                            console.error('Additional image processing error:', err);
                        }
                    }
                }

                // Create portfolio document
                const portfolioData = {
                    title: document.getElementById('title').value,
                    category: document.getElementById('category').value,
                    client: document.getElementById('client').value,
                    advertiser: document.getElementById('client').value,
                    subtitle: document.getElementById('subtitle').value,
                    description: description,
                    metrics: metrics,
                    period: period,
                    author: document.getElementById('author').value,
                    thumbnailUrl: thumbnailUrl,
                    imageUrl: thumbnailUrl,
                    images: [thumbnailUrl, ...additionalImageUrls],
                    homepageUrl: document.getElementById('homepageUrl').value,
                    instagramUrl: document.getElementById('instagramUrl').value,
                    facebookUrl: document.getElementById('facebookUrl').value,
                    youtubeUrl: document.getElementById('youtubeUrl').value,
                    blogUrl: document.getElementById('blogUrl').value,
                    status: 'pending',
                    createdBy: userId,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                console.log('Saving to Firestore...', portfolioData);
                await addDoc(collection(db, 'portfolios'), portfolioData);
                console.log('Successfully saved to Firestore');

                // Success message
                successMsg.textContent = 'âœ… í¬íŠ¸í´ë¦¬ì˜¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ê´€ë¦¬ì ìŠ¹ì¸ í›„ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ì— í‘œì‹œë©ë‹ˆë‹¤.';
                successMsg.classList.add('show');
                portfolioForm.reset();

                // Show alert
                alert('ì œì¶œ ì™„ë£Œ!\n\ní¬íŠ¸í´ë¦¬ì˜¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ìì˜ ìŠ¹ì¸ í›„ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ì— ê²Œì‹œë©ë‹ˆë‹¤.');

                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 8000);

            } catch (error) {
                console.error('Submission error:', error);

                // Detailed error messages
                let errorMessage = 'ì œì¶œ ì‹¤íŒ¨: ';

                if (error.code === 'storage/unauthorized') {
                    errorMessage += 'íŒŒì¼ ì—…ë¡œë“œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. Firebase Storage ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.code === 'permission-denied') {
                    errorMessage += 'Firestore ì“°ê¸° ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. Firebase ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('network')) {
                    errorMessage += 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('storage')) {
                    errorMessage += 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. íŒŒì¼ í¬ê¸°ë‚˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else {
                    errorMessage += error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }

                alert(errorMessage + '\n\nìƒì„¸ ì˜¤ë¥˜:\n' + error.toString());
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit for Approval';
            }
        });
    </script>
</body>

</html>